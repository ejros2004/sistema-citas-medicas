{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üè• Sistema de Citas M√©dicas</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/index.css' %}">
    <link rel="stylesheet" href="{% static 'css/validaciones.css' %}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="container">
        <!-- Header Mejorado -->
        <header class="header">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-hospital-alt"></i>
                    <h1>Sistema de Citas M√©dicas</h1>
                </div>
                <nav class="nav">
                    <button class="nav-btn active" data-tab="pacientes">
                        <i class="fas fa-users"></i>
                        <span>Pacientes</span>
                    </button>
                    <button class="nav-btn" data-tab="medicos">
                        <i class="fas fa-user-md"></i>
                        <span>M√©dicos</span>
                    </button>
                    <button class="nav-btn" data-tab="especialidades">
                        <i class="fas fa-stethoscope"></i>
                        <span>Especialidades</span>
                    </button>
                    <button class="nav-btn" data-tab="citas">
                        <i class="fas fa-calendar-check"></i>
                        <span>Citas</span>
                    </button>
                </nav>
            </div>
        </header>

        <!-- Contenido Principal -->
        <main class="main-content">
            <!-- Secci√≥n Pacientes -->
            <section id="pacientes" class="tab-content active">
                <div class="section-header">
                    <div class="section-title">
                        <i class="fas fa-users"></i>
                        <h2>Gesti√≥n de Pacientes</h2>
                    </div>
                    <div class="result-count" id="pacientesCount">
                        <i class="fas fa-chart-bar"></i>
                        Mostrando <span id="pacientesShowing">0</span> de <span id="pacientesTotal">0</span> pacientes
                    </div>
                    <button class="btn btn-primary" onclick="openPacienteModal()">
                        <i class="fas fa-plus"></i>
                        Nuevo Paciente
                    </button>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="filters">
                            <div class="search-container">
                                <div class="search-input-wrapper">
                                    <i class="fas fa-search search-icon"></i>
                                    <input type="text" id="searchPacientes" placeholder="Buscar pacientes por ID, nombre, DNI, tel√©fono..." class="search-input">
                                </div>
                                <button class="clear-search hidden" onclick="clearSearchPacientes()">
                                    <i class="fas fa-times"></i>
                                    Limpiar
                                </button>
                            </div>
                        </div>
                        <div class="search-hint">
                            <i class="fas fa-lightbulb"></i>
                            <small>Puedes buscar por cualquier campo: ID, nombre completo, DNI, tel√©fono o direcci√≥n</small>
                        </div>
                    </div>

                    <div class="card-body">
                        <div class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th width="80px">ID</th>
                                        <th>Nombre Completo</th>
                                        <th width="140px">DNI</th>
                                        <th width="120px">Tel√©fono</th>
                                        <th>Direcci√≥n</th>
                                        <th width="140px" class="text-center">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="pacientesTableBody">
                                    <!-- Datos din√°micos -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Secci√≥n M√©dicos -->
            <section id="medicos" class="tab-content">
                <div class="section-header">
                    <div class="section-title">
                        <i class="fas fa-user-md"></i>
                        <h2>Gesti√≥n de M√©dicos</h2>
                    </div>
                    <div class="result-count" id="medicosCount">
                        <i class="fas fa-chart-bar"></i>
                        Mostrando <span id="medicosShowing">0</span> de <span id="medicosTotal">0</span> m√©dicos
                    </div>
                    <button class="btn btn-primary" onclick="openMedicoModal()">
                        <i class="fas fa-plus"></i>
                        Nuevo M√©dico
                    </button>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="filters">
                            <div class="search-container">
                                <div class="search-input-wrapper">
                                    <i class="fas fa-search search-icon"></i>
                                    <input type="text" id="searchMedicos" placeholder="Buscar m√©dicos por ID, nombre, especialidad..." class="search-input">
                                </div>
                                <button class="clear-search hidden" onclick="clearSearchMedicos()">
                                    <i class="fas fa-times"></i>
                                    Limpiar
                                </button>
                            </div>
                            <select id="filterEspecialidad" class="select-input">
                                <option value="">Todas las especialidades</option>
                                <!-- Opciones din√°micas -->
                            </select>
                        </div>
                    </div>

                    <div class="card-body">
                        <div class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th width="80px">ID</th>
                                        <th>Nombre</th>
                                        <th>Especialidad</th>
                                        <th width="120px">Tel√©fono</th>
                                        <th width="150px">Horario</th>
                                        <th width="140px" class="text-center">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="medicosTableBody">
                                    <!-- Datos din√°micos -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Secci√≥n Especialidades -->
            <section id="especialidades" class="tab-content">
                <div class="section-header">
                    <div class="section-title">
                        <i class="fas fa-stethoscope"></i>
                        <h2>Gesti√≥n de Especialidades</h2>
                    </div>
                    <div class="result-count" id="especialidadesCount">
                        <i class="fas fa-chart-bar"></i>
                        Mostrando <span id="especialidadesShowing">0</span> de <span id="especialidadesTotal">0</span> especialidades
                    </div>
                    <button class="btn btn-primary" onclick="openEspecialidadModal()">
                        <i class="fas fa-plus"></i>
                        Nueva Especialidad
                    </button>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="filters">
                            <div class="search-container">
                                <div class="search-input-wrapper">
                                    <i class="fas fa-search search-icon"></i>
                                    <input type="text" id="searchEspecialidades" placeholder="Buscar especialidades por nombre..." class="search-input">
                                </div>
                                <button class="clear-search hidden" onclick="clearSearchEspecialidades()">
                                    <i class="fas fa-times"></i>
                                    Limpiar
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="card-body">
                        <div class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th width="80px">ID</th>
                                        <th>Nombre</th>
                                        <th>Descripci√≥n</th>
                                        <th width="150px" class="text-center">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="especialidadesTableBody">
                                    <!-- Datos din√°micos -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Secci√≥n Citas -->
            <section id="citas" class="tab-content">
                <div class="section-header">
                    <div class="section-title">
                        <i class="fas fa-calendar-check"></i>
                        <h2>Gesti√≥n de Citas</h2>
                    </div>
                    <div class="result-count" id="citasCount">
                        <i class="fas fa-chart-bar"></i>
                        Mostrando <span id="citasShowing">0</span> de <span id="citasTotal">0</span> citas
                    </div>
                    <button class="btn btn-primary" onclick="openCitaModal()">
                        <i class="fas fa-plus"></i>
                        Nueva Cita
                    </button>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="filters">
                            <div class="search-container">
                                <div class="search-input-wrapper">
                                    <i class="fas fa-search search-icon"></i>
                                    <input type="text" id="searchCitas" placeholder="Buscar citas por ID, paciente, m√©dico..." class="search-input">
                                </div>
                                <button class="clear-search hidden" onclick="clearSearchCitas()">
                                    <i class="fas fa-times"></i>
                                    Limpiar
                                </button>
                            </div>
                            <div class="filter-group">
                                <input type="date" id="filterFecha" class="search-input">
                                <select id="filterEstado" class="select-input">
                                    <option value="">Todos los estados</option>
                                    <option value="pendiente">Pendiente</option>
                                    <option value="confirmada">Confirmada</option>
                                    <option value="cancelada">Cancelada</option>
                                    <option value="finalizada">Finalizada</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="card-body">
                        <div class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th width="80px">ID</th>
                                        <th>Paciente</th>
                                        <th>M√©dico</th>
                                        <th width="120px">Fecha</th>
                                        <th width="100px">Hora</th>
                                        <th>Motivo</th>
                                        <th width="120px" class="text-center">Estado</th>
                                        <th width="200px" class="text-center">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="citasTableBody">
                                    <!-- Datos din√°micos -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <!-- Loading Spinner Mejorado -->
        <div id="loading" class="loading hidden">
            <div class="loading-content">
                <div class="spinner"></div>
                <p>Procesando solicitud...</p>
            </div>
        </div>
    </div>

    <!-- Modales Mejorados -->
    
    <!-- Modal Paciente -->
    <div id="pacienteModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="pacienteModalTitle">
                    <i class="fas fa-user-plus"></i>
                    Nuevo Paciente
                </h3>
                <button class="modal-close" onclick="closePacienteModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="pacienteForm">
                    <input type="hidden" id="pacienteId">
                    <div class="form-group">
                        <label for="pacienteNombre">
                            <i class="fas fa-user"></i>
                            Nombre Completo: *
                        </label>
                        <input type="text" id="pacienteNombre" required 
                               placeholder="Ingrese nombre completo (solo letras)"
                               oninput="validarNombre(this)">
                        <small class="validation-hint">Solo letras y espacios (m√≠nimo 3 caracteres)</small>
                    </div>
                    <div class="form-group">
                        <label for="pacienteDNI">
                            <i class="fas fa-id-card"></i>
                            DNI: *
                        </label>
                        <input type="text" id="pacienteDNI" required 
                               placeholder="Formato: 001-010101-1000A"
                               oninput="validarDNI(this)">
                        <small class="validation-hint">Formato: 000-000000-0000A</small>
                    </div>
                    <div class="form-group">
                        <label for="pacienteTelefono">
                            <i class="fas fa-phone"></i>
                            Tel√©fono: *
                        </label>
                        <input type="text" id="pacienteTelefono" required 
                               placeholder="8 d√≠gitos"
                               oninput="validarTelefono(this)">
                        <small class="validation-hint">8 d√≠gitos num√©ricos</small>
                    </div>
                    <div class="form-group">
                        <label for="pacienteDireccion">
                            <i class="fas fa-home"></i>
                            Direcci√≥n: *
                        </label>
                        <textarea id="pacienteDireccion" required 
                                  placeholder="Ingrese direcci√≥n completa"
                                  oninput="validarDireccion(this)"></textarea>
                        <small class="validation-hint">M√≠nimo 10 caracteres</small>
                    </div>
                    <div class="form-group">
                        <label for="pacienteFechaNacimiento">
                            <i class="fas fa-birthday-cake"></i>
                            Fecha Nacimiento:
                        </label>
                        <input type="date" id="pacienteFechaNacimiento"
                               onchange="validarFechaNacimiento(this)">
                        <small class="validation-hint">Debe ser una fecha pasada</small>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="closePacienteModal()">
                            <i class="fas fa-times"></i>
                            Cancelar
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i>
                            Guardar
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal M√©dico -->
    <div id="medicoModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="medicoModalTitle">
                    <i class="fas fa-user-md"></i>
                    Nuevo M√©dico
                </h3>
                <button class="modal-close" onclick="closeMedicoModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="medicoForm">
                    <input type="hidden" id="medicoId">
                    <div class="form-group">
                        <label for="medicoNombre">
                            <i class="fas fa-user"></i>
                            Nombre: *
                        </label>
                        <input type="text" id="medicoNombre" required 
                               placeholder="Ingrese nombre del m√©dico"
                               oninput="validarNombre(this)">
                        <small class="validation-hint">Solo letras y espacios (m√≠nimo 3 caracteres)</small>
                    </div>
                    <div class="form-group">
                        <label for="medicoEspecialidad">
                            <i class="fas fa-stethoscope"></i>
                            Especialidad: *
                        </label>
                        <select id="medicoEspecialidad" required>
                            <option value="">Seleccionar especialidad</option>
                            <!-- Opciones din√°micas -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="medicoTelefono">
                            <i class="fas fa-phone"></i>
                            Tel√©fono: *
                        </label>
                        <input type="text" id="medicoTelefono" required 
                               placeholder="8 d√≠gitos"
                               oninput="validarTelefono(this)">
                        <small class="validation-hint">8 d√≠gitos num√©ricos</small>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="medicoHorarioInicio">
                                <i class="fas fa-clock"></i>
                                Horario Inicio: *
                            </label>
                            <input type="time" id="medicoHorarioInicio" required
                                   onchange="validarHorarioMedico()">
                        </div>
                        <div class="form-group">
                            <label for="medicoHorarioFin">
                                <i class="fas fa-clock"></i>
                                Horario Fin: *
                            </label>
                            <input type="time" id="medicoHorarioFin" required
                                   onchange="validarHorarioMedico()">
                        </div>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="closeMedicoModal()">
                            <i class="fas fa-times"></i>
                            Cancelar
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i>
                            Guardar
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Especialidad -->
    <div id="especialidadModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="especialidadModalTitle">
                    <i class="fas fa-stethoscope"></i>
                    Nueva Especialidad
                </h3>
                <button class="modal-close" onclick="closeEspecialidadModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="especialidadForm">
                    <input type="hidden" id="especialidadId">
                    <div class="form-group">
                        <label for="especialidadNombre">
                            <i class="fas fa-tag"></i>
                            Nombre: *
                        </label>
                        <input type="text" id="especialidadNombre" required 
                               placeholder="Ingrese nombre de la especialidad"
                               oninput="validarNombreEspecialidad(this)">
                        <small class="validation-hint">Solo letras y espacios (3-100 caracteres)</small>
                    </div>
                    <div class="form-group">
                        <label for="especialidadDescripcion">
                            <i class="fas fa-file-alt"></i>
                            Descripci√≥n:
                        </label>
                        <textarea id="especialidadDescripcion" 
                                  placeholder="Ingrese descripci√≥n de la especialidad..."
                                  maxlength="500"></textarea>
                        <small class="validation-hint">M√°ximo 500 caracteres</small>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="closeEspecialidadModal()">
                            <i class="fas fa-times"></i>
                            Cancelar
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i>
                            Guardar
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Cita -->
    <div id="citaModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="citaModalTitle">
                    <i class="fas fa-calendar-plus"></i>
                    Nueva Cita
                </h3>
                <button class="modal-close" onclick="closeCitaModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="citaForm">
                    <input type="hidden" id="citaId">
                    <div class="form-group">
                        <label for="citaPaciente">
                            <i class="fas fa-user-injured"></i>
                            Paciente: *
                        </label>
                        <select id="citaPaciente" required>
                            <option value="">Seleccionar paciente</option>
                            <!-- Opciones din√°micas -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="citaMedico">
                            <i class="fas fa-user-md"></i>
                            M√©dico: *
                        </label>
                        <select id="citaMedico" required onchange="actualizarHorarioMedico()">
                            <option value="">Seleccionar m√©dico</option>
                            <!-- Opciones din√°micas -->
                        </select>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="citaFecha">
                                <i class="fas fa-calendar"></i>
                                Fecha: *
                            </label>
                            <input type="date" id="citaFecha" required 
                                   min="" onchange="validarFechaCita()">
                        </div>
                        <div class="form-group">
                            <label for="citaHora">
                                <i class="fas fa-clock"></i>
                                Hora: *
                            </label>
                            <input type="time" id="citaHora" required 
                                   step="1800" onchange="validarHoraCita()">
                            <small class="validation-hint">Intervalos de 30 minutos</small>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="citaMotivo">
                            <i class="fas fa-file-medical"></i>
                            Motivo:
                        </label>
                        <textarea id="citaMotivo" 
                                  placeholder="Descripci√≥n del motivo de la cita..."
                                  maxlength="500"></textarea>
                        <small class="validation-hint">M√°ximo 500 caracteres</small>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="closeCitaModal()">
                            <i class="fas fa-times"></i>
                            Cancelar
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i>
                            Guardar
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal de Confirmaci√≥n para Eliminar -->
    <div id="confirmModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="confirmModalTitle">
                    <i class="fas fa-exclamation-triangle"></i>
                    Confirmar Eliminaci√≥n
                </h3>
                <button class="modal-close" onclick="closeConfirmModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="confirm-icon">
                    <i class="fas fa-trash-alt"></i>
                </div>
                <p id="confirmModalMessage">¬øEst√°s seguro de que quieres eliminar este elemento?</p>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeConfirmModal()">
                        <i class="fas fa-times"></i>
                        Cancelar
                    </button>
                    <button type="button" id="confirmDeleteBtn" class="btn btn-danger">
                        <i class="fas fa-trash-alt"></i>
                        Eliminar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Errores Mejorado -->
    <div id="errorModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="errorModalTitle">
                    <i class="fas fa-exclamation-circle"></i>
                    Error
                </h3>
                <button class="modal-close" onclick="closeErrorModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="error-icon" id="errorModalIcon">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <p id="errorModalMessage">Ha ocurrido un error.</p>
                <div class="error-details" id="errorModalDetails" style="display: none;">
                    <h4>
                        <i class="fas fa-code"></i>
                        Detalles t√©cnicos:
                    </h4>
                    <pre id="errorModalDetailsText" class="error-details-text"></pre>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeErrorModal()">
                        <i class="fas fa-times"></i>
                        Cerrar
                    </button>
                    <button type="button" id="showDetailsBtn" class="btn btn-info" onclick="toggleErrorDetails()" style="display: none;">
                        <i class="fas fa-code"></i>
                        Ver detalles
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="{% static 'js/app.js' %}"></script>
    <script src="{% static 'js/pacientes.js' %}"></script>
    <script src="{% static 'js/medicos.js' %}"></script>
    <script src="{% static 'js/especialidades.js' %}"></script>
    <script src="{% static 'js/citas.js' %}"></script>
    <script src="{% static 'js/validaciones.js' %}"></script>
</body>
</html>